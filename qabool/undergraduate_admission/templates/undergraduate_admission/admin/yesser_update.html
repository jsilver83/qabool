{% extends "base.html" %}
{% load i18n %}
{% load floppyforms %}

{% block content %}
	<div class="container">
		{% if messages %}
			<div class="messages">
				{% for message in messages %}
					<div{% if message.tags %} class="alert alert-{{ message.level_tag }}"{% endif %}>{{ message }}</div>
				{% endfor %}
			</div>
		{% endif %}

		{% if students_count %}
			<div class="row">
				<h2>{% trans 'Progress' %}:</h2>
				<hr>
				<div class="progress">
					<div class="progress-bar" role="progressbar" aria-valuenow="70"
					     aria-valuemin="0" aria-valuemax="100" style="width:1%">
						<span class="sr-only">0% Complete</span>
					</div>
				</div>
				<br>
				{% trans 'Student No' %} <span class="stu_page">1</span> {% trans 'of' %}
				<span class="stu_count">{{ students_count }}</span>
			</div>
			<div class="row">
				<h2>{% trans 'Logs' %}:</h2>
				<hr>
				<ul class="logs">
				</ul>
			</div>
			<div class="row">
				<br><br>
				<table class="table table-striped students" style="width:100%">
					<tr>
						<th style="width: 5%">#</th>
						<th style="width: 10%">{% trans 'Government ID' %}</th>
						<th style="width: 25%">{% trans 'Student Full Name (Arabic)' %}</th>
						<th style="width: 15%">{% trans 'Message Status' %} Before</th>
						<th style="width: 15%">{% trans 'Message Status' %} After</th>
						<th style="width: 15%">{% trans 'High School Before' %}</th>
						<th style="width: 15%">{% trans 'High School After' %}</th>
						<th style="width: 15%">{% trans 'Quodrat Before' %}</th>
						<th style="width: 15%">{% trans 'Quodrat After' %}</th>
						<th style="width: 15%">{% trans 'Tahsili Before' %}</th>
						<th style="width: 15%">{% trans 'Tahsili After' %}</th>
					</tr>
				</table>
			</div>
			<br>
			<hr>
			<br>
		{% endif %}
	</div>
{% endblock content %}
{% block scripts %}
	<script type="application/javascript">
		$(function () {
			var page = 1;
			var total_pages = parseInt($(".stu_count").html());
			tries = 1;
			max_tries = 3;

			while (page <= total_pages) {

				tries = 1;
				while (tries <= 1) {
					$.ajax({
						type: "GET",
						contentType: "application/json; charset=utf-8",
						url: "/admin/qiyasupdate/",
						data: {"page": page},
						async: false,
						dataType: "json",
						success: function (data) {
							tr_html = '<tr>' +
									  '<td>' + page + '</td>' +
									  '<td>' + data.gov_id + '</td>' +
									  '<td>' + data.student_full_name_ar + '</td>' +
									  '<td>' + data.status_before + '</td>' +
									  '<td>' + data.status + '</td>' +
									  '<td>' + data.hs_before + '</td>' +
									  '<td>' + data.hs + '</td>' +
									  '<td>' + data.qudrat_before + '</td>' +
									  '<td>' + data.qudrat + '</td>' +
									  '<td>' + data.tahsili_before + '</td>' +
									  '<td>' + data.tahsili + '</td>' +
									  '</tr>';
							$(".students").append(tr_html)
							if(data.log.length > 0) {
								$(".logs").prepend('<li>' + data.log + '</li>');
							}
							var progress = page / total_pages * 100;
							$(".progress-bar").attr("style", "width:" + progress + "%");
							$(".stu_page").html(page);
							page++;
							tries = max_tries;
						},
						complete: function (jqXHR, textStatus) {
							tries++;
						}
					});
				}
			}
		})
		;
	</script>
{% endblock scripts %}